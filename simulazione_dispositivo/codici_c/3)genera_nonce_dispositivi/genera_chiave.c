#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <time.h>
#include <string.h>

#include "my_utility.h"
#include "pc_utils.h"
#include "puf.h"

unsigned const int __attribute__((section(".version"))) optiboot_version = 2049U;
uint8_t __attribute__((section(".noinit"))) bss_puf[PUF_SIZE];

int main(int argc, char *argv[]){
    srand(time(NULL));
        
    
    uint8_t puf_response[PUF_SIZE] = {0U};
    uint8_t helper_data[PUF_SIZE] = {0U};
    uint8_t key[FE_KEY_SIZE] = {0U};

    // conversione delle string in uint
    hex_string_to_bytes("5E3AFD27DBD3F3C6D7F1CFDBD7FFFD576C7FB6FAEAD4FE88763AD23FF1D5FA5BDBE68FB68EFF2BBB26F29BAFDFD9DD1FFE7F751F7E6BFC21FE977F797FCE0FDB5C77FF53FB7FF3645953CA5F9FD5BE5E5FFDA348629E52ECFFE5A1B0897BF6BE7DB8B59FF9EE196E7FEE8F2E69BB69F637AFCCED7EFF67FF2DE996BC9FE1BFF4BCDF7F5F41DE8F734F12BF3FFF5677FFF799F6FF9FBFFFFB7E7BB08EE7FFF45A6CEBFA4D39FF92FFAF52D6E5E7BEFF76570DF34FEE71BE7E62D2F7FFED3CCFE7D645F7AFD7F9F1FEEEFFBFDF9FDFEBB95CE901AF3F736CD8EBF9F5CB7EE9BF97FB73DB7F5B59BEF5EBC63BAFD76CAFB8FDD5FBDCE7EF5B8E79F37775EFFEEBE49F43FFEA7B8BCFFBEAC996DDBC95DFEBE187FFD29923947F975EFF6F3BB7F3A58ABBF46F94BADDC9BB47EF7EBFEAC635", puf_response, PUF_SIZE);
    hex_string_to_bytes("98B0E5006BA67AF787D245220CA57FDF57055F5D2AAC812C1455341DAA82CA03793333F488ECACD63672BB33F48BF85466EE7422C8DB9890767766A0D5A1DE9804E7C14F73F6F9E80F47A41DD8E586F8225A7A0A84A5ADE17E5E784AEAFD22A532B22D2CA2718BC39F343B9CC1C793035DCF4EEF8712C49EED41642BDBC3C6F74827A14F5B142D205A5E0E7B79B0EE02152D99E33A8DA07545AC4987F615AA14F85C23BA7ABEE51121F803D8F833C80844DD77D99B432BECB6CD3E3139FA9906C7E0CAE4FA4DF904BFB09EB4B61FB0A64A844AE6F25BA27A5E944AA52143A85DBED9FAC3EA298379BC7320CBA208E060EB145E54362A0269EB13591F55098F098D90FA7D8E9F230425C4A6DB6F7E1C20540E82E890AC5A157704CDA6BABA4D51333118C668CC73786133CCC4C6942196", helper_data, PUF_SIZE);

   

    // genero la chiave ki
    puf_extract(puf_response, helper_data, key);

    print_buffer_as_json("key", key, FE_KEY_SIZE,
                            NULL);
    
}